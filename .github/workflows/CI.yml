name: CI

on: [push, pull_request]

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:

      # ----------------------------------------------------
      # STEP 1 — CHECKOUT REPOSITORY
      # ----------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4


      # ----------------------------------------------------
      # STEP 2 — LINT (clang-format)
      # ----------------------------------------------------
      - name: Install clang-format
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format

      - name: Run lint (clang-format check only)
        run: |
          find . -name "*.c" -o -name "*.h" | \
            xargs clang-format -style=LLVM -n


      # ----------------------------------------------------
      # STEP 3 — TESTS (optional)
      # ----------------------------------------------------
      - name: Run tests if Makefile exists
        run: |
          if [ -f Makefile ]; then
            make test || true
          else
            echo "No tests found — skipping."
          fi


      # ----------------------------------------------------
      # STEP 4 — STATIC ANALYSIS (cppcheck)
      # -----------------------------------------
